---
import projects from "../data/projects.json";
---
<div id="projects" class="windowContainerOuter window">
  <div class="windowContainer">
    <div class="windowOptionsBar draggable">
      <div id="windowButtons">
        <button class="windowMinimize" onclick="windowMinimize(this)"></button>
        <button class="windowMaximize" onclick="windowMaximize(this)"></button>
        <button class="windowExit" onclick="windowClose(this)"></button>
      </div>
    </div>
    <div class="windowTitleBar">Projects</div>
    <div class="windowContent">
      <div class="projects-grid" id="projectsGrid">
        {projects.map((p) => (
          <div class="project-card" data-slug={p.slug} data-title={p.title} data-summary={p.summary} data-image={p.image} data-links={JSON.stringify(p.links)} data-highlights={JSON.stringify(p.highlights)} data-stack={JSON.stringify(p.stack)}>
            <img src={p.image} alt={`${p.title} icon`} />
            <h5>{p.title}</h5>
            <div>
              {p.stack.slice(0,2).map((s) => (<span class="stack-chip">{s}</span>))}
            </div>
          </div>
        ))}
      </div>
    </div>
  </div>
</div>

<div class="project-modal-backdrop" id="projectBackdrop"></div>
<div class="project-modal windowContainerOuter window" id="projectModal" style="display:none;">
  <div class="windowContainer">
    <div class="windowOptionsBar draggable">
      <button class="windowMinimize" onclick="windowMinimize(this)"></button>
      <button class="windowMaximize" onclick="windowMaximize(this)"></button>
      <button class="windowExit" onclick="(function(){ document.getElementById('projectModal').style.display='none'; document.getElementById('projectBackdrop').classList.remove('active'); })()"></button>
    </div>
    <div class="windowTitleBar" id="projectTitleBar">Project</div>
    <div class="windowContent">
      <div style="display:flex; gap: 12px; align-items:flex-start;">
        <img id="projectImage" alt="project image" style="width: 40px; height: 40px;" />
        <div>
          <p id="projectSummary"></p>
          <div id="projectStack"></div>
          <ul id="projectHighlights"></ul>
          <div id="projectLinks" class="modal-links"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script is:inline>
  (function(){
    const grid = document.getElementById('projectsGrid');
    const modal = document.getElementById('projectModal');
    const backdrop = document.getElementById('projectBackdrop');
    const titleBar = document.getElementById('projectTitleBar');
    const img = document.getElementById('projectImage');
    const summary = document.getElementById('projectSummary');
    const stackEl = document.getElementById('projectStack');
    const highlightsEl = document.getElementById('projectHighlights');
    const linksEl = document.getElementById('projectLinks');

    grid.addEventListener('click', (e) => {
      const card = e.target.closest('.project-card');
      if(!card) return;
      const title = card.dataset.title;
      const image = card.dataset.image;
      const sum = card.dataset.summary;
      const stack = JSON.parse(card.dataset.stack || '[]');
      const highlights = JSON.parse(card.dataset.highlights || '[]');
      const links = JSON.parse(card.dataset.links || '{}');

      titleBar.textContent = title;
      img.src = image; img.alt = title + ' image';
      summary.textContent = sum;
      stackEl.innerHTML = stack.map(s => `<span class="stack-chip">${s}</span>`).join('');
      highlightsEl.innerHTML = highlights.map(h => `<li>${h}</li>`).join('');
      linksEl.innerHTML = '';
      if (links.github) linksEl.innerHTML += `<a href="${links.github}" target="_blank">GitHub</a>`;
      if (links.demo) linksEl.innerHTML += `<a href="${links.demo}" target="_blank">Demo</a>`;

      modal.style.display = 'block';
      backdrop.classList.add('active');
    });

    backdrop.addEventListener('click', () => { modal.style.display='none'; backdrop.classList.remove('active'); });
  })();
</script>

